<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jul 16, 2013 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title></title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20130716" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                VersionOne.SDK.Java.APIClient
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
        
                <div class="xleft">
        <span id="publishDate">Last Published: 2013-07-16</span>
                  &nbsp;| <span id="projectVersion">Version: 13.0.1</span>
                      </div>
            <div class="xright">        
        
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
        
                                <h5>Overview</h5>
                  <ul>
                  <li class="none">
                          <a href="introduction.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="information_model.html" title="Information Model">Information Model</a>
            </li>
                  <li class="none">
                          <a href="setup.html" title="Setup">Setup</a>
            </li>
                  <li class="none">
                          <a href="queries.html" title="Queries">Queries</a>
            </li>
                  <li class="none">
            <strong>Updates</strong>
          </li>
                  <li class="none">
                          <a href="new_asset.html" title="New Asset">New Asset</a>
            </li>
                  <li class="none">
                          <a href="operations.html" title="Operations">Operations</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                        <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
        
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Learn By Example: Updates<a name="Learn_By_Example:_Updates"></a></h2><p>Updating assets through the APIClient involves calling the Save method on the IServices object.</p><div class="section"><h3>How to update a scalar attribute on an asset<a name="How_to_update_a_scalar_attribute_on_an_asset"></a></h3><p>Updating a scalar attribute on an asset is accomplished by calling the SetAttribute method on an asset, specifying the IAttributeDefinition of the attribute you wish to change and the new scalar value. This code will update the Name attribute on the Story with ID 1094:</p>
<div class="source"><pre>public Asset UpdateScalarAttribute() throws Exception
{
    Oid storyId = Oid.fromToken(&quot;Story:1094&quot;, metaModel);
    Query query = new Query(storyId);
    IAssetType storyType = metaModel.getAssetType(&quot;Story&quot;);
    IAttributeDefinition nameAttribute = storyType.getAttributeDefinition(&quot;Name&quot;);
    query.getSelection().add(nameAttribute);
    QueryResult result = services.retrieve(query);
    Asset story = result.getAssets()[0];
    String oldName = story.getAttribute(nameAttribute).getValue().toString();
    story.setAttributeValue(nameAttribute, GetNewName());
    services.save(story);

    System.out.println(story.getOid().getToken());
    System.out.println(oldName);
    System.out.println(story.getAttribute(nameAttribute).getValue());
    /***** OUTPUT *****
     Story:1094:1446
     Logon
     New Name
    ******************/

    return story;
}
</pre></div></div><div class="section"><h3>How to update a single-value relation on an asset<a name="How_to_update_a_single-value_relation_on_an_asset"></a></h3><p>Updating a single-value relation is accomplished by calling the SetAttribute method on an asset, specifying the IAttributeDefinition of the attribute you wish to change and the ID for the new relation. This code will change the source of the Story with ID 1094:</p>
<div class="source"><pre>public Asset UpdateSingleValueRelation() throws Exception
{
    Oid storyId = Oid.fromToken(&quot;Story:1094&quot;, metaModel);
    Query query = new Query(storyId);
    IAssetType storyType = metaModel.getAssetType(&quot;Story&quot;);
    IAttributeDefinition sourceAttribute = storyType.getAttributeDefinition(&quot;Source&quot;);
    query.getSelection().add(sourceAttribute);
    QueryResult result = services.retrieve(query);
    Asset story = result.getAssets()[0];
    String oldSource = story.getAttribute(sourceAttribute).getValue().toString();
    story.setAttributeValue(sourceAttribute, GetNextSourceID(oldSource));
    services.save(story);

    System.out.println(story.getOid().getToken());
    System.out.println(oldSource);
    System.out.println(story.getAttribute(sourceAttribute).getValue());
    /***** OUTPUT *****
     Story:1094:1446
     StorySource:148
     StorySource:149
    ******************/

    return story;
}
</pre></div></div><div class="section"><h3>How to add and remove values from a multi-value relation<a name="How_to_add_and_remove_values_from_a_multi-value_relation"></a></h3><p>Updating a multi-value relation is accomplished by calling either the RemoveAttributeValue or AddAttributeValue method on an asset, specifying the IAttributeDefinition of the attribute you wish to change and the ID of the relation you wish to add or remove. This code will add one Member and remove another Member from the Story with ID 1094:</p>
<div class="source"><pre>public Asset UpdateMultiValueRelation() throws Exception
{
    Oid storyId = Oid.fromToken(&quot;Story:1094&quot;, metaModel);
    Query query = new Query(storyId);
    IAssetType storyType = metaModel.getAssetType(&quot;Story&quot;);
    IAttributeDefinition ownersAttribute = storyType.getAttributeDefinition(&quot;Owners&quot;);
    query.getSelection().add(ownersAttribute);
    QueryResult result = services.retrieve(query);
    Asset story = result.getAssets()[0];
    List&amp;lt;Object&amp;gt; oldOwners = new ArrayList&amp;lt;Object&amp;gt;();
    oldOwners.addAll(Arrays.asList(story.getAttribute(ownersAttribute).getValues()));
    story.removeAttributeValue(ownersAttribute, getOwnerToRemove(oldOwners));
    story.addAttributeValue(ownersAttribute, getOwnerToAdd(oldOwners));
    services.save(story);

    System.out.println(story.getOid().getToken());
    Iterator&amp;lt;Object&amp;gt; iter = oldOwners.iterator();
    while(iter.hasNext())
    {
    	Oid oid = (Oid) iter.next();
        System.out.println(oid.getToken());
    }
    for(Object o : story.getAttribute(ownersAttribute).getValues())
    {
    	Oid oid = (Oid)o;
        System.out.println(oid.getToken());
    }
    /***** OUTPUT *****
     Story:1094:1446
     Member:1003
     Member:1000
    ******************/

    return story;
}
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2013
                        <a href="http://www.versionone.com/">Version One, Inc.</a>.
            All Rights Reserved.      
        
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
